<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="Ansonika">
    <title>峰旗旅行</title>

    <!-- Favicons-->
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" type="image/x-icon" href="img/apple-touch-icon-57x57-precomposed.png">
    <link rel="apple-touch-icon" type="image/x-icon" sizes="72x72" href="img/apple-touch-icon-72x72-precomposed.png">
    <link rel="apple-touch-icon" type="image/x-icon" sizes="114x114"
          href="img/apple-touch-icon-114x114-precomposed.png">
    <link rel="apple-touch-icon" type="image/x-icon" sizes="144x144"
          href="img/apple-touch-icon-144x144-precomposed.png">

    <!-- BASE CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/vendors.css" rel="stylesheet">

    <!-- YOUR CUSTOM CSS -->
    <link href="css/custom.css" rel="stylesheet">

    <!-- COMMON SCRIPTS -->
    <script src="js/jquery-2.2.4.min.js"></script>

</head>

<body>

<div id="page">

    <header id="header" class="header menu_fixed">

    </header>
    <!-- /header -->

    <main>
        <section id="section1" class="hero_in tours_detail">
            <div class="wrapper">
                <div class="container">
                    <h1 id="sitedetailname" class="fadeInUp"><span></span></h1>
                </div>
            </div>
        </section>
        <!--/hero_in-->

        <div class="bg_color_1">
            <nav class="secondary_nav sticky_horizontal">
                <div class="container">
                    <ul class="clearfix">
                        <li><a href="#description" class="active">介绍</a></li>
                        <li><a href="#reviews">评价</a></li>
                        <li><a href="#booking">评价</a></li>
                    </ul>
                </div>
            </nav>
            <div class="container margin_60_35">

                <div class="row">
                    <div class="col-lg-8">
                        <section id="description">
                            <h2>介绍</h2>
                            <p id="siteDes"></p>
                            <hr>
                            <h2>图片</h2>
                            <div id="sitePicture">
                                <img id="detailfengmian" class="img-fluid" alt="" width="400" height="200">
                                <div style="float: right" class="wrapper">
                                <span id="morepicture" class="magnific-gallery">
                                </span>
                                </div>
                            </div>

                            <hr>
                            <h3>周边酒店</h3>
                            <ul id="zbjd" class="cbp_tmtimeline">

                            </ul>
                            <hr>
                        </section>
                        <!-- /section -->

                        <section id="reviews">
                            <!-- /review-container -->


                        <div class="add-review">
                            <h5>景点评论</h5>
                            <div id="allpl">
                            </div>
                            <hr>
                            <form>
                                <div class="row">
                                    <div class="form-group col-md-6">
                                        <h6>评分 </h6>
                                        <div class="custom-select-form">
                                            <select name="rating_review" id="rating_review" class="wide">
                                                <option value="1">1 (lowest)</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5" selected>5 (medium)</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10">10 (highest)</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group col-md-12">
                                        <h6>评论</h6>
                                        <textarea name="review_text" id="review_text" class="form-control"
                                                  style="height:130px;"></textarea>
                                    </div>
                                    <div class="form-group col-md-12 add_top_20">
                                        <input type="button" value="评论" class="btn_1" id="submit-review" onclick="tjpl()">
                                    </div>
                                </div>
                            </form>
                        </div>
                        </section>
                    </div>
                    <!-- /col -->

                    <aside class="col-lg-4" id="sidebar">
                        <div class="box_detail booking">
                            <div class="price">
                                <span id="cost"><small>人均消费</small>￥</span>
                                <div id="visit_grade" class="score"></div>
                            </div>
                        </div>
                    </aside>
                </div>
                <!-- /row -->
            </div>
            <!-- /container -->
        </div>
        <!-- /bg_color_1 -->
    </main>
    <!--/main-->

    <footer id="footer">
    </footer>
    <!--/footer-->
</div>
<!-- page -->

<div id="toTop"></div><!-- Back to top button -->

<!-- COMMON SCRIPTS -->
<script src="js/common_scripts.js"></script>
<script src="js/main.js"></script>
<script src="assets/validate.js"></script>
<script>
    $(document).ready(function () {
        $("#header").load("header.html");
        $("#footer").load("footer.html");
    });
</script>

<!-- INPUT QUANTITY  -->
<script src="js/input_qty.js"></script>

<!-- INSTAGRAM FEED  -->
<script>
//    $(window).on('load', function () {
//        "use strict";
//        $.instagramFeed({
//            'username': 'thelouvremuseum',
//            'container': "#instagram-feed",
//            'display_profile': false,
//            'display_biography': false,
//            'display_gallery': true,
//            'get_raw_json': false,
//            'callback': null,
//            'styling': true,
//            'items': 12,
//            'items_per_row': 4,
//            'margin': 1
//        });
//    });
</script>
<script>
    $(function () {
        var url = window.location.search; //获取url中"?"符后的字串
        var siteId;
        var token = window.sessionStorage.getItem("token");
        if (url.indexOf("?") != -1) {
            siteId = url.substr(url.indexOf("=") + 1);
        }
        $.ajax({
            url: "http://localhost:8002/hotel/sites/" + siteId,
            type: "GET",
            async: false,
            dataType: "json",
            beforeSend: function (e) {
                e.setRequestHeader("Authorization", "bearer " + token);
            },
            success: function (data) {
                $("#siteDes").html(data.siteDescribe);
                if (data.siteCost == 10) {
                    $("#cost").append("1000+");
                } else {
                    $("#cost").append(data.siteCost + "49");
                }
                $("#sitedetailname").append(data.siteName);
                $("#detailfengmian").attr('src', 'sites/' + data.pictures[0]);
                $("#visit_grade").append("<span><em>"+data.visitTimes+" Reviews</em></span><strong>"+data.siteGrade+"</strong>");

                var i = 1;
                var pictureContext = "";
                pictureContext = "<a href=\"sites/"+data.pictures[0]+"\" class=\"btn_1\" title=\"Photo title\" data-effect=\"mfp-zoom-in\">更多图片</a>\n";
                $("#morepicture").append(pictureContext);
                for (i in data.pictures) {
                    pictureContext = "<a id=\"img3\" href=\"sites/"+data.pictures[i]+"\" title=\"Photo title\" data-effect=\"mfp-zoom-in\"></a>\n"
                    $("#morepicture").append(pictureContext);
                    pictureContext = "";
                }
            }
        });
        $.ajax({
            url: "http://localhost:8002/hotel/house/site/" + siteId,
            type: "GET",
            async: false,
            dataType: "json",
            beforeSend: function (e) {
                e.setRequestHeader("Authorization", "bearer " + token);
            },
            success: function (data) {
                var i = 0;
                for (i in data) {
                    var context = "<li>\n" +
                        "   <div class=\"box_list\" style=\"  margin: 0 0 10px 15px;min-height: 200px;\">\n" +
                        "            <div class=\"row no-gutters\" style=\"height: 200px;\">\n" +
                        "            <div class=\"col-lg-5\">\n" +
                        "            <figure style=\"min-height: 200px;\">\n" +
                        "            <a href=\"hotels-grid-isotope.html?hotelId=" + data[i].id + "\"><img src=\"house/" + data[i].pictures[0] + "\" class=\"img-fluid\" alt=\"\" width=\"800\" height=\"200\">\n" +
                        "            <div class=\"read_more\"><span>查看</span></div>\n" +
                        "        </a>\n" +
                        "        </figure>\n" +
                        "        </div>\n" +
                        "        <div class=\"col-lg-7\">\n" +
                        "            <div class=\"wrapper\">\n" +
                        "            <h3><a href=\"\">" + data[i].hotelName + "</a></h3>\n" +
                        "        <p>" + data[i].hotelDescribe + "</p>\n" +
                        "        </div>\n" +
                        "        </div>\n" +
                        "        </div>\n" +
                        "        </div>\n" +
                        "        </li>";
                    $("#zbjd").append(context);
                    context = "";
                }
            }
        });
        $.ajax({
            url: "http://localhost:8002/hotel/comment/site/" + siteId,
            type: "GET",
            async: false,
            dataType: "json",
            beforeSend: function (e) {
                e.setRequestHeader("Authorization", "bearer " + token);
            },
            success: function (data) {
                var i = 0;
                var context = "";
                for (i in data){
                    context = "<div class=\"review-box clearfix\">\n" +
                        "    </figure>\n" +
                        "    <div class=\"rev-content\">\n" +
                        "\n" +
                        "        <div class=\"rev-info\">"+data[i].userName+" :</div>" +
                        "        <div class=\"rev-text\">\n" +
                        "<p style='margin: 2px 0'>"+data[i].context+"</p>" +
                        "        </div>\n" +
                        "    </div>\n" +
                        "</div>";
                    $("#allpl").append(context);
                    context = "";
                }
            }
        });

    });
    
    function tjpl() {
        var grade = $("#rating_review").val();
        var text = $("#review_text").val();
        var url = window.location.search; //获取url中"?"符后的字串
        var siteId;
        var token = window.sessionStorage.getItem("token");
        var userId = $("#headUserId").val();
        if (url.indexOf("?") != -1) {
            siteId = url.substr(url.indexOf("=") + 1);
        }
        $.ajax({
            url: "http://localhost:8002/hotel/comment",
            type: "POST",
            async: false,
            data:{"context":text,"Id":siteId,"type":"site","grade":grade,"userId":userId},
            dataType: "text",
            beforeSend: function (e) {
                e.setRequestHeader("Authorization", "bearer " + token);
            },
            success: function (data) {
                alert(data);
                location.reload(true);
            }
        });
    }
</script>

</body>
</html>
